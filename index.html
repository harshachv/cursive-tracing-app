<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Cursive Tracing App</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 10px;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      overscroll-behavior: none;
      touch-action: none;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    canvas {
      border: 1px solid #ccc;
      display: block;
      margin: 0 auto;
      touch-action: none;
    }
    .controls, .actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin: 15px 0;
    }
    #canvas-container {
      position: relative;
      width: 100%;
      max-width: 900px;
      height: 300px;
      margin: 0 auto;
    }
    .background-text {
      font-family: 'Great Vibes', cursive;
      font-size: 180px;
      color: rgba(0, 0, 0, 0.15);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Cursive Tracing Practice</h2>
    <div class="controls">
      <select id="example-select"></select>
      <button onclick="clearCanvas()">Clear</button>
    </div>

    <div id="canvas-container">
      <div id="background" class="background-text">A</div>
      <canvas id="canvas" width="900" height="300"></canvas>
    </div>

    <div class="actions">
      <button onclick="checkAccuracy()">Check Accuracy</button>
      <button onclick="nextItem()">Next</button>
    </div>

    <p id="score"></p>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const backgroundDiv = document.getElementById("background");
    const select = document.getElementById("example-select");
    let drawing = false;
    let currentIndex = 0;

    const practiceItems = [
      ..."ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      ..."abcdefghijklmnopqrstuvwxyz",
      "apple","ball","cat","dog","elephant","fish","goat","hat","ice","juice",
      "kite","lion","monkey","nest","orange","pen","queen","rat","sun","tree",
      "umbrella","van","whale","xylophone","yarn","zebra"
    ];

    function updateSelectOptions() {
      select.innerHTML = "";
      practiceItems.forEach((item, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.text = item;
        select.appendChild(option);
      });
    }

    function drawGridLines() {
      const lineHeight = canvas.height / 3;
      ctx.save();
      ctx.strokeStyle = "#ddd";
      ctx.lineWidth = 1;
      for (let i = 1; i < 3; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * lineHeight);
        ctx.lineTo(canvas.width, i * lineHeight);
        ctx.stroke();
      }
      ctx.restore();
    }

    function showItem(index) {
      const text = practiceItems[index];
      backgroundDiv.innerText = text;
      select.value = index;
      clearCanvas();
    }

    canvas.addEventListener("mousedown", (e) => {
      drawing = true;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(x, y);
    });

    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mouseleave", () => drawing = false);
    canvas.addEventListener("mousemove", draw);

    canvas.addEventListener("touchstart", e => {
      e.preventDefault();
      drawing = true;
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      const y = e.touches[0].clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(x, y);
    }, { passive: false });

    canvas.addEventListener("touchend", () => drawing = false);
    canvas.addEventListener("touchcancel", () => drawing = false);

    canvas.addEventListener("touchmove", e => {
      e.preventDefault();
      draw(e.touches[0]);
    }, { passive: false });

    function draw(e) {
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX || e.pageX) - rect.left;
      const y = (e.clientY || e.pageY) - rect.top;

      ctx.lineWidth = 3;
      ctx.lineCap = "round";
      ctx.strokeStyle = "#000";
      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGridLines();
      ctx.beginPath();
      document.getElementById("score").innerText = "";
    }

    function nextItem() {
      currentIndex = (currentIndex + 1) % practiceItems.length;
      showItem(currentIndex);
    }

    select.addEventListener("change", () => {
      currentIndex = parseInt(select.value);
      showItem(currentIndex);
    });

    function checkAccuracy() {
      const bgCanvas = document.createElement('canvas');
      bgCanvas.width = canvas.width;
      bgCanvas.height = canvas.height;
      const bgCtx = bgCanvas.getContext('2d');
      bgCtx.font = '180px "Great Vibes"';
      bgCtx.fillStyle = 'rgba(0,0,0,0.8)';
      bgCtx.textAlign = 'center';
      bgCtx.textBaseline = 'middle';
      bgCtx.fillText(backgroundDiv.innerText, canvas.width/2, canvas.height/2);

      const userData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      const bgData = bgCtx.getImageData(0, 0, canvas.width, canvas.height).data;
      let match = 0;
      let total = 0;

      for (let i = 0; i < userData.length; i += 4) {
        const isUserDrawn = userData[i+3] > 50;
        const isBgLetter = bgData[i+3] > 50;
        if (isUserDrawn && isBgLetter) {
          match++;
        }
        if (isBgLetter) {
          total++;
        }
      }

      const score = total ? Math.round((match / total) * 100) : 0;
      document.getElementById("score").innerText = `Accuracy: ${score}%`;

      setTimeout(() => {
        nextItem();
      }, 1500);
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateSelectOptions();
      showItem(currentIndex);
    });
  </script>
</body>
</html>
